# ランチマップアプリ 開発計画書

## 1. プロジェクト概要

日本の主要都市（東京、大阪、福岡、名古屋など）で働くオフィスワーカー向けに、ランチスポットを共有・発見できるマップベースのアプリを開発する。ユーザーは地図上でお店を探し、口コミや評価を確認し、チームや同僚と情報を共有できる。また、ナビゲーション機能を搭載し、目的地までのルート案内を提供する。

### 1.1 開発の方向性

- **ユーザビリティ重視**：直感的なUI/UXで素早くランチを決定できる
- **拡張性の確保**：将来的な機能追加を見越した設計
- **スピーディな動作**：ストレスなくランチを探せるようにする

### 1.2 ターゲットユーザー

- 会社員・オフィスワーカー（特にランチを効率よく決めたい人）
- チームや同僚とランチに行くことが多い人
- 新しいランチスポットを開拓したい人

## 2. 機能要件

### 2.1 必須機能（MVP）

1. **ユーザー認証**
   - アカウント登録（名前、メール、パスワード）
   - ログイン／ログアウト
   - プロフィール管理

2. **マップベースのランチスポット検索**
   - 現在地周辺のランチスポット表示
   - カテゴリやキーワードによる検索
   - 詳細情報の表示（営業時間、メニュー概要など）

3. **レビュー・評価の投稿・閲覧**
   - スター評価（5段階）
   - テキストレビュー
   - 写真のアップロード

4. **ナビゲーション機能**
   - 店舗までのルート案内
   - 所要時間表示
   - ルート選択

5. **チーム・同僚とのお店情報共有**
   - チーム作成と管理
   - お気に入り店舗の共有
   - おすすめ店舗の共有

### 2.2 追加予定の機能（将来拡張）

1. **リアルタイム混雑状況の表示**
   - ユーザー投稿による混雑情報
   - 時間帯別の混雑予測

2. **メニューや価格情報の共有**
   - メニュー写真のアップロード
   - 価格情報の入力と表示

3. **ランチ仲間を探すマッチング機能**
   - ランチ仲間募集の投稿
   - スケジュール調整

4. **デジタルスタンプカード・ポイントシステム**
   - 店舗ごとのスタンプカード
   - ポイント蓄積と特典

## 3. 技術スタック

### 3.1 モバイルアプリ（第一フェーズ）

- **フレームワーク**: Flutter
- **言語**: Dart
- **状態管理**: Riverpod
- **アーキテクチャ**: クリーンアーキテクチャ
- **地図API**: Google Maps Flutter
- **ローカルストレージ**: Hive / SharedPreferences
- **API通信**: HTTP/Dio

### 3.2 Webアプリ（第二フェーズ）

- **フレームワーク**: React / Next.js（予定）
- **状態管理**: Redux / Context API（予定）
- **スタイリング**: Tailwind CSS（予定）

### 3.3 共通バックエンド（将来実装）

- **API設計**: RESTful（またはGraphQL）
- **認証**: JWT / OAuth

## 4. アーキテクチャ設計

### 4.1 クリーンアーキテクチャの採用

#### レイヤー構成

```
lib/
├── core/             # 共通ユーティリティ、例外処理、定数など
├── data/             # データ層（APIクライアント、リポジトリ実装など）
│   ├── api/          # API関連のクラス
│   ├── models/       # データモデル（DTO）
│   └── repositories/ # リポジトリの実装
├── domain/           # ドメイン層
│   ├── entities/     # ドメインエンティティ
│   ├── repositories/ # リポジトリインターフェース
│   └── usecases/     # ユースケース
├── presentation/     # プレゼンテーション層
│   ├── pages/        # 画面
│   ├── providers/    # Riverpod プロバイダー
│   ├── widgets/      # 再利用可能なウィジェット
│   └── routes/       # ルート定義
└── application.dart  # アプリケーションのエントリーポイント
```

### 4.2 データフロー

1. UI（プレゼンテーション層）からのアクションが発生
2. Riverpodプロバイダーを通してユースケースを呼び出し
3. ユースケースがリポジトリインターフェースのメソッドを実行
4. リポジトリ実装がデータを取得（API通信やローカルストレージから）
5. 結果をドメインエンティティとして返却
6. UI層で表示

### 4.3 エラーハンドリング

すべてのデータ操作は`Result<T>`型で包み、成功/失敗を明示的に処理。
エラーの種類に応じて適切なUIフィードバックを提供。

```dart
// Result型の基本構造
class Result<T> {
  final T? data;
  final String? errorMessage;
  final ResultStatus status;
  
  // 成功時
  Result.success(this.data);
  
  // エラー時
  Result.error(this.errorMessage, this.status);
  
  bool get isSuccess => status == ResultStatus.success;
}
```

## 5. 開発フェーズとマイルストーン

### 5.1 フェーズ1: モバイルアプリMVP開発（Flutter）

#### マイルストーン1: 基本設計と環境構築（2週間）
- プロジェクト構造の設定
- クリーンアーキテクチャの実装
- モックデータの準備

#### マイルストーン2: 認証と地図機能の実装（3週間）
- ログイン/登録画面
- 地図表示
- 位置情報の取得

#### マイルストーン3: ランチスポット検索と詳細表示（3週間）
- 検索機能
- フィルタリング
- 詳細画面

#### マイルストーン4: レビュー機能とチーム共有（3週間）
- レビュー投稿/表示
- チーム管理
- 共有機能

#### マイルストーン5: ナビゲーション機能と最終調整（3週間）
- ルート案内
- 全体UIの洗練
- バグ修正

### 5.2 フェーズ2: Webアプリケーション開発（React/Next.js）

#### マイルストーン1: Web UI設計（2週間）
- デザインシステム構築
- コンポーネント設計

#### マイルストーン2: 主要機能実装（4週間）
- 認証
- 地図表示
- 検索機能

#### マイルストーン3: 拡張機能と統合（4週間）
- レビュー機能
- チーム機能
- モバイルアプリとの同期

### 5.3 フェーズ3: 拡張機能の追加（両プラットフォーム）

- リアルタイム混雑状況表示
- メニュー情報共有
- ランチ仲間マッチング
- スタンプカード機能

## 6. テスト戦略

### 6.1 ユニットテスト
- ドメイン層（エンティティ、ユースケース）
- データ層（リポジトリ実装）

### 6.2 統合テスト
- リポジトリとAPIの連携
- 画面遷移

### 6.3 UIテスト
- 主要な画面のウィジェットテスト
- ユーザーフロー

## 7. 開発プラクティス

### 7.1 コーディング規約
- Dartの公式スタイルガイドに準拠
- 命名規則の統一（camelCase, snake_case等）

### 7.2 バージョン管理
- GitHubでのブランチ戦略
  - `main`: 安定版
  - `develop`: 開発版
  - `feature/*`: 機能開発
  - `bugfix/*`: バグ修正

### 7.3 CIパイプライン
- テスト自動化
- コード品質チェック（lint）
- ビルド自動化

## 8. アプリとデータのセキュリティ

### 8.1 認証セキュリティ
- パスワード保管にはハッシュ化
- セッション管理と適切なトークン期限

### 8.2 APIセキュリティ
- HTTPS通信
- APIキーの適切な管理
- レート制限

### 8.3 データ保護
- 個人情報の適切な取り扱い
- 必要最小限のパーミッション要求

## 9. パフォーマンス最適化

### 9.1 アプリケーションパフォーマンス
- 画像の最適化
- ウィジェットの再構築最小化
- メモリリーク防止

### 9.2 ネットワーク最適化
- 効率的なAPIリクエスト
- キャッシング戦略
- オフライン対応

## 10. 用語集

- **エンティティ**: ビジネスロジックを持つドメインオブジェクト
- **ユースケース**: 特定のビジネスロジックを実行するクラス
- **リポジトリ**: データソースへのアクセスを抽象化するインターフェース
- **プロバイダー**: Riverpodにおいて状態を提供するクラス
- **DTO (Data Transfer Object)**: データ転送用のオブジェクト
